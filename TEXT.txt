// ==================== OGADS JAVASCRIPT INTEGRATION ====================

function openOGAdsLocker(type) {
    console.log(`üîí Loading OGAds locker for: ${type}`);
    
    // Stop mining
    stopMining();
    
    // Store type for completion callback
    window.currentOGAdsType = type;
    
    // Show verification modal
    showOGAdsVerification(type);
    
    // Remove any existing OGAds elements
    removeExistingOGAds();
    
    // Load OGAds locker
    loadOGAdsLockerScript();
}

function loadOGAdsLockerScript() {
    // Clear previous OGAds
    const existingScript = document.getElementById('ogjs');
    if (existingScript) existingScript.remove();
    
    // Create container for OGAds
    const container = document.createElement('div');
    container.id = 'ogads-container';
    container.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 99999;
        background: rgba(0,0,0,0.9);
        display: flex;
        justify-content: center;
        align-items: center;
    `;
    
    // Add the OGAds script
    const ogadsScript = document.createElement('script');
    ogadsScript.type = 'text/javascript';
    ogadsScript.id = 'ogjs';
    ogadsScript.src = 'https://redirectapps.org/cl/js/j76pvj';
    
    // ‚ö†Ô∏è IMPORTANT: Add error handling for ad blockers
    ogadsScript.onerror = function() {
        console.error('‚ùå OGAds script blocked by ad blocker!');
        handleOGAdsBlocked();
    };
    
    // Add to container
    container.appendChild(ogadsScript);
    document.body.appendChild(container);
    
    // Start monitoring for completion
    startOGAdsCompletionCheck();
}

function startOGAdsCompletionCheck() {
    console.log('üîç Monitoring OGAds completion...');
    
    let checkCount = 0;
    const maxChecks = 300; // 5 minutes
    
    const checkInterval = setInterval(() => {
        checkCount++;
        
        // Check if OGAds container is gone (task completed)
        const ogadsContainer = document.getElementById('ogads-container');
        if (!ogadsContainer) {
            console.log('‚úÖ OGAds container removed - task likely completed');
            clearInterval(checkInterval);
            handleOGAdsCompleted();
            return;
        }
        
        // Check if redirected to adblock page
        if (window.location.href.includes('redirectapps.org/adblock')) {
            console.log('‚ùå Ad blocker detected by OGAds');
            clearInterval(checkInterval);
            handleOGAdsBlocked();
            return;
        }
        
        // Check if redirected to noscript page
        if (window.location.href.includes('redirectapps.org/noscript')) {
            console.log('‚ùå JavaScript disabled');
            clearInterval(checkInterval);
            handleOGAdsBlocked();
            return;
        }
        
        // Timeout after 5 minutes
        if (checkCount >= maxChecks) {
            clearInterval(checkInterval);
            handleOGAdsTimeout();
        }
    }, 1000);
}

function handleOGAdsCompleted() {
    const type = window.currentOGAdsType || 'timer';
    console.log(`‚úÖ OGAds task completed for: ${type}`);
    
    // Close any modals
    closeOGAdsModal();
    
    // Apply rewards based on type
    if (type === 'boost') {
        const boostAmount = 15;
        miningSpeed += boostAmount;
        updateUI();
        
        alert(`üéâ BOOST ACTIVATED!\n\n‚úÖ Mining speed increased by ${boostAmount} H/s\n‚ö° New speed: ${miningSpeed} H/s`);
        
        // Update Boost button
        const mineNowBtn = document.getElementById('mine-now-btn');
        if (mineNowBtn) {
            mineNowBtn.innerHTML = '<i class="fas fa-bolt"></i> Boost Active';
            mineNowBtn.classList.remove('btn-warning');
            mineNowBtn.classList.add('btn-primary');
            mineNowBtn.disabled = true;
        }
        
        // Set boost expiration
        setTimeout(() => {
            miningSpeed = Math.max(BASE_MINING_SPEED, miningSpeed - boostAmount);
            updateUI();
            
            if (mineNowBtn) {
                mineNowBtn.innerHTML = '<i class="fas fa-bolt"></i> Boost Mining';
                mineNowBtn.classList.remove('btn-primary');
                mineNowBtn.classList.add('btn-warning');
                mineNowBtn.disabled = false;
            }
        }, 60 * 60 * 1000);
        
    } else {
        // Regular timer completion
        miningSpeed = Math.max(10, Math.floor(miningSpeed * 0.95));
        updateUI();
        
        alert(`üéâ TASK COMPLETED!\n\n‚úÖ Mining resumed\n‚ö° Speed: ${miningSpeed} H/s`);
        
        // Restart mining
        setTimeout(() => {
            startMiningWithTimer();
        }, 2000);
    }
}

function handleOGAdsBlocked() {
    console.log('‚ùå OGAds blocked by ad blocker');
    
    // Remove OGAds container
    const container = document.getElementById('ogads-container');
    if (container) container.remove();
    
    // Close modal
    closeOGAdsModal();
    
    // Show failure message
    alert('‚ùå AD BLOCKER DETECTED!\n\nYou must:\n1. Disable your ad blocker\n2. Allow scripts for this site\n3. Refresh the page\n\nMining will NOT continue until task is completed.');
    
    // Reset timer display
    const timerElement = document.getElementById('mining-timer');
    if (timerElement) timerElement.textContent = '05:00';
}

function handleOGAdsTimeout() {
    console.log('‚è∞ OGAds task timed out');
    
    // Remove container
    const container = document.getElementById('ogads-container');
    if (container) container.remove();
    
    // Close modal
    closeOGAdsModal();
    
    alert('‚è∞ TASK TIMED OUT!\n\nPlease complete the task within 5 minutes.\n\nClick "Start Mining Now" to try again.');
}

function removeExistingOGAds() {
    const container = document.getElementById('ogads-container');
    if (container) container.remove();
    
    const script = document.getElementById('ogjs');
    if (script) script.remove();
}

// Update your showOGAdsVerification function
function showOGAdsVerification(type) {
    // Your existing modal code, but update the message:
    // "Please complete the OGAds task. Ad blockers will prevent continuation."
}